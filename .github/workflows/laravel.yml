name: Laravel Syntax Check Only

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  syntax-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup PHP 8.2
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'
          extensions: mbstring, xml, ctype, iconv, intl

      - name: Create Minimal .env (No Database)
        run: |
          echo "APP_ENV=testing" > .env
          echo "APP_KEY=base64:testkey123456789012345678901234567890" >> .env
          echo "CACHE_DRIVER=array" >> .env
          echo "SESSION_DRIVER=array" >> .env
          echo "QUEUE_CONNECTION=sync" >> .env

      - name: Install Dependencies
        run: composer install --no-ansi --no-interaction --no-scripts --no-progress --prefer-dist

      - name: Check PHP Syntax
        run: |
          echo "üìÅ Checking PHP syntax..."
          find app -name "*.php" -type f -exec php -l {} \;
          echo "‚úÖ App directory syntax OK!"
          
          find database -name "*.php" -type f -exec php -l {} \;
          echo "‚úÖ Database directory syntax OK!"
          
          php -l routes/web.php
          echo "‚úÖ Routes syntax OK!"

      - name: Check Laravel Commands (Safe)
        run: |
          # Commands yang tidak butuh database
          php artisan --version
          php artisan route:list --except-vendor || echo "‚ö†Ô∏è Route list may fail"
          
          # Clear cache tanpa database
          php artisan config:clear && echo "‚úÖ Config cleared"
          php artisan view:clear && echo "‚úÖ View cleared"
          php artisan route:clear && echo "‚úÖ Route cleared"

      - name: Completion
        run: echo "‚úÖ All checks completed successfully!"